{
  handleCount++;
  String text=null;
  try {
    final URI requestedUri=httpExchange.getRequestURI();
    final String remoteAddress=httpExchange.getRemoteAddress().getAddress().getHostAddress();
    final Map<String,String> parameters=getRequestQuery(httpExchange,requestedUri);
    if (requestLimiter != null && !requestLimiter.isAccessOkay(remoteAddress)) {
      final String errorMessage="Error: Access from " + StringTools.escapeXML(remoteAddress) + " denied - too many requests. Allowed maximum requests: "+ requestLimiter.getRequestLimit()+ " requests per "+ requestLimiter.getRequestLimitPeriodInSeconds()+ " seconds";
      sendError(httpExchange,HttpURLConnection.HTTP_FORBIDDEN,errorMessage);
      print(errorMessage);
      return;
    }
    if (allowedIps == null || allowedIps.contains(remoteAddress)) {
      if (requestedUri.getRawPath().endsWith("/Languages")) {
        printListOfLanguages(httpExchange);
      }
 else {
        text=parameters.get("text");
        if (text == null) {
          throw new IllegalArgumentException("Missing 'text' parameter");
        }
        checkText(text,httpExchange,parameters);
      }
    }
 else {
      final String errorMessage="Error: Access from " + StringTools.escapeXML(remoteAddress) + " denied";
      sendError(httpExchange,HttpURLConnection.HTTP_FORBIDDEN,errorMessage);
      throw new RuntimeException(errorMessage);
    }
  }
 catch (  Exception e) {
    if (verbose) {
      print("Exception was caused by this text: " + text);
    }
    e.printStackTrace();
    final String response="Error: " + StringTools.escapeXML(Tools.getFullStackTrace(e));
    sendError(httpExchange,HttpURLConnection.HTTP_INTERNAL_ERROR,response);
  }
 finally {
    handleCount--;
    httpExchange.close();
  }
}
