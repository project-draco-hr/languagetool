{
  if (stack.size() > 0) {
    return stack.pop();
  }
 else {
    final Token t=input.next();
    if (t == null)     return null;
    final List<String> wordList=new ArrayList<String>();
    wordList.add(t.termText());
    final List<AnalyzedTokenReadings> atr=tagger.tag(wordList);
    for (    Object anAtr : atr) {
      final AnalyzedGermanTokenReadings atrs=(AnalyzedGermanTokenReadings)anAtr;
      final List<AnalyzedToken> ats=atrs.getReadings();
      for (      Object at1 : ats) {
        final AnalyzedToken at=(AnalyzedToken)at1;
        if (at.getPOSTag() != null) {
          final Token posToken=new Token(at.getPOSTag(),t.startOffset(),t.endOffset());
          posToken.setPositionIncrement(0);
          stack.push(posToken);
        }
        final Set<String> indexLemmas=new HashSet<String>();
        if (at.getLemma() != null) {
          final String lemma=at.getLemma().toLowerCase();
          if (!lemma.equalsIgnoreCase(t.termText()) && !indexLemmas.contains(lemma)) {
            final Token posToken=new Token(BASEFORM_PREFIX + lemma,t.startOffset(),t.endOffset());
            posToken.setPositionIncrement(0);
            stack.push(posToken);
            indexLemmas.add(lemma);
          }
        }
      }
    }
    return new Token(TEXTFORM_PREFIX + t.termText().toLowerCase(),t.startOffset(),t.endOffset());
  }
}
