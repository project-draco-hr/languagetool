{
  InputStream stream=SuggestionReplacerTest.class.getResourceAsStream("/org/languagetool/dev/wikipedia/wikipedia.txt");
  String origMarkup=IOUtils.toString(stream);
  JLanguageTool langTool=new JLanguageTool(new GermanyGerman());
  langTool.disableRule(GermanSpellerRule.RULE_ID);
  langTool.disableRule("DE_AGREEMENT");
  langTool.disableRule("GERMAN_WORD_REPEAT_BEGINNING_RULE");
  langTool.disableRule("COMMA_PARENTHESIS_WHITESPACE");
  langTool.disableRule("DE_CASE");
  langTool.disableRule("ABKUERZUNG_LEERZEICHEN");
  langTool.disableRule("TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN");
  SwebleWikipediaTextFilter filter=new SwebleWikipediaTextFilter();
  PlainTextMapping mapping=filter.filter(origMarkup);
  List<RuleMatch> matches=langTool.check(mapping.getPlainText());
  assertThat("Expected 3 matches, got: " + matches,matches.size(),is(3));
  String markup=origMarkup;
  int oldPos=0;
  for (  RuleMatch match : matches) {
    SuggestionReplacer replacer=new SuggestionReplacer(mapping,markup,"<s>","</s>");
    List<RuleApplication> ruleApplications=replacer.applySuggestionsToOriginalText(match);
    assertThat(ruleApplications.size(),is(1));
    RuleApplication ruleApplication=ruleApplications.get(0);
    assertThat(StringUtils.countMatches(ruleApplication.getTextWithCorrection(),"absichtlicher absichtlicher"),is(2));
    int pos=ruleApplication.getTextWithCorrection().indexOf("<s>absichtlicher</s> Fehler");
    if (pos == -1) {
      pos=ruleApplication.getTextWithCorrection().indexOf("<s>absichtlicher Fehler</s>");
    }
    assertTrue("Found correction at: " + pos,pos > oldPos);
    oldPos=pos;
  }
}
