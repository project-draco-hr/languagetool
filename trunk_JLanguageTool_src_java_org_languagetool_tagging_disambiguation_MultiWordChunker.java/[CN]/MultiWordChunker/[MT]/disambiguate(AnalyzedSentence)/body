{
  lazyInit();
  final AnalyzedTokenReadings[] anTokens=input.getTokens();
  final AnalyzedTokenReadings[] output=anTokens;
  for (int i=0; i < anTokens.length; i++) {
    final String tok=output[i].getToken();
    final StringBuilder tokens=new StringBuilder();
    int finalLen=0;
    if (mStartSpace.containsKey(tok)) {
      final int len=mStartSpace.get(tok);
      int j=i;
      int lenCounter=0;
      while (j < anTokens.length) {
        if (!anTokens[j].isWhitespace()) {
          tokens.append(anTokens[j].getToken());
          if (mFull.containsKey(tokens.toString())) {
            final AnalyzedToken tokenStart=new AnalyzedToken(tok,"<" + mFull.get(tokens.toString()) + ">",tokens.toString());
            output[i].addReading(tokenStart);
            final AnalyzedToken tokenEnd=new AnalyzedToken(anTokens[finalLen].getToken(),"</" + mFull.get(tokens.toString()) + ">",tokens.toString());
            output[finalLen].addReading(tokenEnd);
          }
          lenCounter++;
          if (lenCounter == len) {
            break;
          }
          tokens.append(' ');
        }
        j++;
        finalLen=j;
      }
    }
    if (mStartNoSpace.containsKey(tok)) {
      final int len=mStartNoSpace.get(tok);
      if (i + len <= anTokens.length) {
        for (int j=i; j < i + len; j++) {
          tokens.append(anTokens[j].getToken());
          if (mFull.containsKey(tokens.toString())) {
            final AnalyzedToken tokenStart=new AnalyzedToken(tok,"<" + mFull.get(tokens.toString()) + ">",tokens.toString());
            output[i].addReading(tokenStart);
            final AnalyzedToken tokenEnd=new AnalyzedToken(anTokens[i + len - 1].getToken(),"</" + mFull.get(tokens.toString()) + ">",tokens.toString());
            output[i + len - 1].addReading(tokenEnd);
          }
        }
      }
    }
  }
  return new AnalyzedSentence(output);
}
