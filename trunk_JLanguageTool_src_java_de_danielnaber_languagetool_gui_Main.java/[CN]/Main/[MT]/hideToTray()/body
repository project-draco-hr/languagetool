{
  final String version=System.getProperty("java.version");
  if (!isInTray && version.startsWith("1.5")) {
    TrayIcon trayIcon=null;
    try {
      Icon sysTrayIcon=new ImageIcon(JLanguageTool.getDataBroker().getFromResourceDirAsUrl(Main.SYSTEM_TRAY_ICON_NAME));
      trayIcon=new TrayIcon(sysTrayIcon);
    }
 catch (    final NoClassDefFoundError e) {
      throw new MissingJdicException(e);
    }
    final SystemTray tray=SystemTray.getDefaultSystemTray();
    trayIcon.addActionListener(new TrayActionListener());
    trayIcon.setToolTip(SYSTEM_TRAY_TOOLTIP);
    tray.addTrayIcon(trayIcon);
  }
 else   if (!isInTray) {
    final java.awt.SystemTray tray=java.awt.SystemTray.getSystemTray();
    final Image img=Toolkit.getDefaultToolkit().getImage(JLanguageTool.getDataBroker().getFromResourceDirAsUrl(Main.SYSTEM_TRAY_ICON_NAME));
    final PopupMenu popup=makePopupMenu();
    try {
      final java.awt.TrayIcon trayIcon=new java.awt.TrayIcon(img,"tooltip",popup);
      trayIcon.addMouseListener(new TrayActionListener());
      trayIcon.setToolTip(SYSTEM_TRAY_TOOLTIP);
      tray.add(trayIcon);
    }
 catch (    final AWTException e1) {
      Tools.showError(e1);
    }
  }
  isInTray=true;
  frame.setVisible(false);
}
