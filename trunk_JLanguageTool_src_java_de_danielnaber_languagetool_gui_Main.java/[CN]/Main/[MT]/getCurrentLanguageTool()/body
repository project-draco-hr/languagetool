{
  JLanguageTool langTool;
  try {
    final ConfigurationDialog configDialog=getCurrentConfigDialog();
    langTool=new JLanguageTool(getCurrentLanguage(),configDialog.getMotherTongue());
    langTool.activateDefaultPatternRules();
    langTool.activateDefaultFalseFriendRules();
    final Set<String> disabledRules=configDialog.getDisabledRuleIds();
    if (disabledRules != null) {
      for (      final String ruleId : disabledRules) {
        langTool.disableRule(ruleId);
      }
    }
    final Set<String> disabledCategories=configDialog.getDisabledCategoryNames();
    if (disabledCategories != null) {
      for (      final String categoryName : disabledCategories) {
        langTool.disableCategory(categoryName);
      }
    }
  }
 catch (  final IOException ioe) {
    throw new RuntimeException(ioe);
  }
catch (  final ParserConfigurationException ex) {
    throw new RuntimeException(ex);
  }
catch (  final SAXException ex) {
    throw new RuntimeException(ex);
  }
  return langTool;
}
