{
  final JLanguageTool langTool;
  try {
    final ConfigurationDialog configDialog=getCurrentConfigDialog();
    langTool=new JLanguageTool(getCurrentLanguage(),configDialog.getMotherTongue());
    langTool.activateDefaultPatternRules();
    langTool.activateDefaultFalseFriendRules();
    final Set<String> disabledRules=configDialog.getDisabledRuleIds();
    if (disabledRules != null) {
      for (      final String ruleId : disabledRules) {
        langTool.disableRule(ruleId);
      }
    }
    final Set<String> disabledCategories=configDialog.getDisabledCategoryNames();
    if (disabledCategories != null) {
      for (      final String categoryName : disabledCategories) {
        langTool.disableCategory(categoryName);
      }
    }
    final Set<String> enabledRules=configDialog.getEnabledRuleIds();
    if (enabledRules != null) {
      for (      String ruleName : enabledRules) {
        langTool.enableDefaultOffRule(ruleName);
        langTool.enableRule(ruleName);
      }
    }
  }
 catch (  final Exception e) {
    throw new RuntimeException(e);
  }
  return langTool;
}
