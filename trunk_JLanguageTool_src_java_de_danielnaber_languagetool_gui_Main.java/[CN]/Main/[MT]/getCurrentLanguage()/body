{
  if (autoDetectBox.isSelected()) {
    LanguageIdentifier li=new LanguageIdentifier(textArea.getText());
    Language lang=Language.getLanguageForShortName(li.getLanguage());
    if (lang != null) {
      for (int i=0; i < languageBox.getItemCount(); i++) {
        I18nLanguage boxLanguage=(I18nLanguage)languageBox.getItemAt(i);
        if (boxLanguage.getLanguage().getName() == lang.getName()) {
          languageBox.setSelectedIndex(i);
        }
      }
      return Language.getLanguageForShortName(li.getLanguage());
    }
 else {
      for (int i=0; i < languageBox.getItemCount(); i++) {
        I18nLanguage boxLanguage=(I18nLanguage)languageBox.getItemAt(i);
        if (boxLanguage.getLanguage().getName() == Language.ENGLISH.getName()) {
          languageBox.setSelectedIndex(i);
        }
      }
      return Language.ENGLISH;
    }
  }
 else {
    return ((I18nLanguage)languageBox.getSelectedItem()).getLanguage();
  }
}
