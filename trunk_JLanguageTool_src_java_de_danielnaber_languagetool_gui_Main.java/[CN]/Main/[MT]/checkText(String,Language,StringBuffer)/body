{
  long startTime=System.currentTimeMillis();
  JLanguageTool lt=new JLanguageTool(language);
  File defaultPatternFile=new File(de.danielnaber.languagetool.Main.RULES_DIR + File.separator + language.getShortName()+ File.separator+ de.danielnaber.languagetool.Main.PATTERN_FILE);
  List patternRules=new ArrayList();
  if (defaultPatternFile.exists()) {
    patternRules=lt.loadPatternRules(defaultPatternFile.getAbsolutePath());
  }
 else {
    sb.append("Pattern file " + defaultPatternFile.getAbsolutePath() + " not found<br>\n");
  }
  for (Iterator iter=patternRules.iterator(); iter.hasNext(); ) {
    Rule rule=(Rule)iter.next();
    lt.addRule(rule);
  }
  List ruleMatches=lt.check(text);
  long startTimeMatching=System.currentTimeMillis();
  for (Iterator iter=ruleMatches.iterator(); iter.hasNext(); ) {
    RuleMatch match=(RuleMatch)iter.next();
    sb.append("<br>\n<b>Line " + (match.getLine() + 1) + ", column "+ match.getColumn()+ "</b><br>\n");
    String msg=match.getMessage();
    msg=msg.replaceAll("<suggestion>","<b>");
    msg=msg.replaceAll("</suggestion>","</b>");
    msg=msg.replaceAll("<old>","<b>");
    msg=msg.replaceAll("</old>","</b>");
    sb.append("<b>Message:</b> " + msg + "<br>\n");
    sb.append("<b>Context:</b> " + getContext(match.getFromPos(),match.getToPos(),text));
    sb.append("<br>\n");
  }
  long endTime=System.currentTimeMillis();
  sb.append("<br>\nTime: " + (endTime - startTime) + "ms (including "+ (endTime - startTimeMatching)+ "ms for rule matching)<br>\n");
  return ruleMatches.size();
}
