{
  InputStreamReader isr=null;
  BufferedReader br=null;
  final StringBuilder sb=new StringBuilder();
  try {
    if (encoding == null) {
      isr=new InputStreamReader(stream);
    }
 else {
      isr=new InputStreamReader(stream,encoding);
    }
    br=new BufferedReader(isr);
    String line;
    while ((line=br.readLine()) != null) {
      sb.append(line);
      sb.append('\n');
    }
  }
  finally {
    if (br != null) {
      br.close();
    }
    if (isr != null) {
      isr.close();
    }
  }
  return sb.toString();
}
