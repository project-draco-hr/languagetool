{
  directory=newDirectory();
  final Language language=Language.ENGLISH;
  final JLanguageTool lt=new JLanguageTool(language);
  lt.activateDefaultPatternRules();
  System.out.println("Creating index...");
  createIndex(language,lt);
  System.out.println("Done.");
  int ruleCounter=0;
  int ruleProblems=0;
  int relaxedQueryCount=0;
  searcher=new IndexSearcher(directory);
  final List<Rule> rules=lt.getAllActiveRules();
  for (  Rule rule : rules) {
    if (rule instanceof PatternRule && !rule.isDefaultOff()) {
      final PatternRule patternRule=(PatternRule)rule;
      try {
        ruleCounter++;
        final SearcherResult searcherResult=errorSearcher.findRuleMatchesOnIndex(patternRule,language,searcher);
        if (searcherResult.isRelaxedQuery()) {
          relaxedQueryCount++;
        }
        final List<MatchingSentence> matchingSentences=searcherResult.getMatchingSentences();
        boolean foundExpectedMatch=false;
        for (        MatchingSentence matchingSentence : matchingSentences) {
          final List<RuleMatch> ruleMatches=matchingSentence.getRuleMatches();
          final List<String> ruleMatchIds=getRuleMatchIds(ruleMatches);
          if (ruleMatchIds.contains(getFullId(patternRule))) {
            foundExpectedMatch=true;
            break;
          }
        }
        if (!foundExpectedMatch) {
          System.out.println("Error: No match found for " + patternRule);
          System.out.println("Query   : " + searcherResult.getPossiblyRelaxedQuery());
          System.out.println("Matches : " + matchingSentences);
          System.out.println("Examples: " + rule.getIncorrectExamples());
          System.out.println();
          ruleProblems++;
        }
      }
 catch (      NullPointerException e) {
        System.out.println("NullPointerException searching for rule " + getFullId(patternRule));
        ruleProblems++;
      }
    }
  }
  System.out.println(language + ": problems: " + ruleProblems+ ", total rules: "+ ruleCounter);
  System.out.println(language + ": relaxedQueryCount: " + relaxedQueryCount);
}
