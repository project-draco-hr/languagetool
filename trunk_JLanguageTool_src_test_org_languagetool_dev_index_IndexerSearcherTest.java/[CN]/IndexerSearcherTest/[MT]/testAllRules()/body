{
  final Language language=Language.ENGLISH;
  final JLanguageTool lt=new JLanguageTool(language);
  lt.activateDefaultPatternRules();
  System.out.println("Creating index...");
  final int ruleCount=createIndex(lt);
  System.out.println("Index created with " + ruleCount + " rules");
  int ruleCounter=0;
  int ruleProblems=0;
  int relaxedQueryCount=0;
  final DirectoryReader reader=DirectoryReader.open(directory);
  try {
    searcher=new IndexSearcher(reader);
    final List<Rule> rules=lt.getAllActiveRules();
    for (    Rule rule : rules) {
      if (rule instanceof PatternRule && !rule.isDefaultOff()) {
        final PatternRule patternRule=(PatternRule)rule;
        try {
          ruleCounter++;
          final SearcherResult searcherResult=errorSearcher.findRuleMatchesOnIndex(patternRule,language,searcher);
          if (searcherResult.isRelaxedQuery()) {
            relaxedQueryCount++;
          }
          final List<MatchingSentence> matchingSentences=searcherResult.getMatchingSentences();
          boolean foundExpectedMatch=false;
          for (          MatchingSentence matchingSentence : matchingSentences) {
            final List<RuleMatch> ruleMatches=matchingSentence.getRuleMatches();
            final List<String> ruleMatchIds=getRuleMatchIds(ruleMatches);
            if (ruleMatchIds.contains(getFullId(patternRule))) {
              foundExpectedMatch=true;
              break;
            }
          }
          if (!foundExpectedMatch) {
            System.out.println("Error: No match found for " + patternRule);
            System.out.println("Query   : " + searcherResult.getPossiblyRelaxedQuery());
            System.out.println("Matches : " + matchingSentences);
            System.out.println("Examples: " + rule.getIncorrectExamples());
            System.out.println();
            ruleProblems++;
          }
 else {
          }
        }
 catch (        NullPointerException e) {
          System.out.println("NullPointerException searching for rule " + getFullId(patternRule));
          ruleProblems++;
        }
      }
    }
  }
  finally {
    reader.close();
  }
  System.out.println(language + ": problems: " + ruleProblems+ ", total rules: "+ ruleCounter);
  System.out.println(language + ": relaxedQueryCount: " + relaxedQueryCount);
}
