{
  final File file=new File(filename);
  if (file.length() < MAXFILESIZE) {
    final String text=getFilteredText(filename,encoding);
    if (!taggerOnly) {
      Tools.checkText(text,lt,apiFormat);
    }
 else {
      Tools.tagText(text,lt);
    }
    if (listUnknownWords) {
      System.out.println("Unknown words: " + lt.getUnknownWords());
    }
  }
 else {
    if (verbose)     lt.setOutput(System.err);
    if (!apiFormat)     System.out.println("Working on " + filename + "... in a buffered mode (100 lines)");
    InputStreamReader isr=null;
    BufferedReader br=null;
    int counter=0;
    StringBuffer sb=new StringBuffer();
    try {
      if (encoding != null) {
        isr=new InputStreamReader(new BufferedInputStream(new FileInputStream(file.getAbsolutePath())),encoding);
      }
 else {
        isr=new InputStreamReader(new BufferedInputStream(new FileInputStream(file.getAbsolutePath())));
      }
      br=new BufferedReader(isr);
      String line;
      while ((line=br.readLine()) != null) {
        sb.append(line);
        sb.append("\n");
        counter++;
        if (counter == 100) {
          if (!taggerOnly) {
            Tools.checkText(filterXML(sb.toString()),lt,apiFormat);
          }
 else {
            Tools.tagText(filterXML(sb.toString()),lt);
          }
          if (listUnknownWords) {
            System.out.println("Unknown words: " + lt.getUnknownWords());
          }
          sb=new StringBuffer();
          counter=0;
        }
      }
    }
  finally {
      if (counter > 0) {
        if (!taggerOnly) {
          Tools.checkText(filterXML(sb.toString()),lt,apiFormat);
        }
 else {
          Tools.tagText(filterXML(sb.toString()),lt);
        }
        if (listUnknownWords) {
          System.out.println("Unknown words: " + lt.getUnknownWords());
        }
      }
      if (br != null) {
        br.close();
      }
      if (isr != null) {
        isr.close();
      }
    }
  }
}
