{
  final File directory=new File(resource.toURI());
  if (!directory.exists() && !directory.isDirectory()) {
    throw new Exception("Directory does not exist: " + directory.getAbsolutePath());
  }
  for (  final File file : directory.listFiles()) {
    if (file.isFile() && file.getName().endsWith(".class")) {
      final String classShortNm=file.getName().substring(0,file.getName().lastIndexOf('.'));
      if (classNameRegEx == null || classShortNm.matches(classNameRegEx)) {
        final Class clazz=Class.forName(packageName + "." + classShortNm);
        if (!isMaterial(clazz)) {
          continue;
        }
        if (classExtends == null || isExtending(clazz,classExtends.getName()) && interfaceImplements == null || isImplementing(clazz,interfaceImplements)) {
          foundClasses.put(clazz,file.getAbsolutePath());
        }
      }
    }
  }
  if (subdirLevel > 0) {
    for (    final File dir : directory.listFiles()) {
      if (dir.isDirectory()) {
        final Class[] subLevelClasses=findClasses(classLoader,packageName + "." + dir.getName(),classNameRegEx,subdirLevel - 1,classExtends,interfaceImplements);
        for (        Class tmpClass : subLevelClasses) {
          foundClasses.put(tmpClass,"dir:" + dir.getAbsolutePath());
        }
      }
    }
  }
}
