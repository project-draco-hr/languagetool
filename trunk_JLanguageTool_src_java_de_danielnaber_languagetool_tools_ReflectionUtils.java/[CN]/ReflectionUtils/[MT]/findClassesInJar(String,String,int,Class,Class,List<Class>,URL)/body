{
  final JarURLConnection conn=(JarURLConnection)resource.openConnection();
  final JarFile currentFile=conn.getJarFile();
  for (final Enumeration<JarEntry> e=currentFile.entries(); e.hasMoreElements(); ) {
    final JarEntry current=e.nextElement();
    final String name=current.getName();
    if (name.endsWith(".class")) {
      final String classNm=name.replaceAll("/",".").replace(".class","");
      final int pointIdx=classNm.lastIndexOf('.');
      final String classShortNm=pointIdx == -1 ? classNm : classNm.substring(pointIdx + 1);
      if (classNm.startsWith(packageName) && (classNameRegEx == null || classShortNm.matches(classNameRegEx))) {
        final String subName=classNm.substring(packageName.length() + 1);
        if (countOccurrences(subName,'.') > subdirLevel) {
          continue;
        }
        final Class clazz=Class.forName(classNm);
        if (foundClasses.contains(clazz)) {
          throw new RuntimeException("Duplicate class definition:\n" + clazz.getName() + ", found in\n"+ currentFile.getName());
        }
        if (!isMaterial(clazz)) {
          continue;
        }
        if (classExtends == null || isExtending(clazz,classExtends.getName()) && interfaceImplements == null || isImplementing(clazz,interfaceImplements)) {
          foundClasses.add(clazz);
        }
      }
    }
  }
}
