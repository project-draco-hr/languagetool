{
  List<Class> foundClasses=new ArrayList<Class>();
  try {
    String packagePath=packageName.replace('.','/');
    Enumeration<URL> resources_=classLoader.getResources(packagePath);
    Set<URL> uniqResources=new HashSet<URL>();
    for (; resources_.hasMoreElements(); ) {
      URL resource=resources_.nextElement();
      if (resource.getProtocol().equals("jar")) {
        String jarPath=resource.getPath().substring(0,resource.getPath().indexOf('!'));
        uniqResources.add(new URL(jarPath));
      }
 else {
        uniqResources.add(resource);
      }
    }
    for (    URL resource : uniqResources) {
      if (resource.getPath().endsWith("jar")) {
        if (resource.getPath().endsWith("LanguageTool.uno.jar")) {
          continue;
        }
        findClassesInJar(packageName,classNameRegEx,subdirLevel,classExtends,interfaceImplements,foundClasses,resource);
      }
 else {
        findClassesInDirectory(classLoader,packageName,classNameRegEx,subdirLevel,classExtends,interfaceImplements,foundClasses,resource);
      }
    }
  }
 catch (  Exception ex) {
    throw new ClassNotFoundException("Loading rules failed: " + ex.getMessage(),ex);
  }
  return foundClasses.toArray(new Class[0]);
}
