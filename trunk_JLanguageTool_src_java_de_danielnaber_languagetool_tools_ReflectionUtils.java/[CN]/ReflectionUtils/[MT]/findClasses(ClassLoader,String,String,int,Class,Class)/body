{
  List<Class> foundClasses=new ArrayList<Class>();
  try {
    String packagePath=packageName.replace('.','/');
    Enumeration<URL> resources_=classLoader.getResources(packagePath);
    Set<URL> uniqResources=new HashSet<URL>();
    while (resources_.hasMoreElements()) {
      URL resource=resources_.nextElement();
      uniqResources.add(resource);
    }
    for (    URL resource : uniqResources) {
      if (resource.getProtocol().startsWith("jar")) {
        findClassesInJar(packageName,classNameRegEx,subdirLevel,classExtends,interfaceImplements,foundClasses,resource);
      }
 else {
        findClassesInDirectory(classLoader,packageName,classNameRegEx,subdirLevel,classExtends,interfaceImplements,foundClasses,resource);
      }
    }
  }
 catch (  Exception ex) {
    throw new ClassNotFoundException("Loading rules failed: " + ex.getMessage(),ex);
  }
  return foundClasses.toArray(new Class[foundClasses.size()]);
}
