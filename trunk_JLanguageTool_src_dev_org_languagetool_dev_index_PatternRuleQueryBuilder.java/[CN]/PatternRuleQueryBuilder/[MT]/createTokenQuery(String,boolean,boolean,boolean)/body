{
  SpanQuery q=null;
  if (token != null && !token.equals("")) {
    if (!isNegation) {
      final String text=isRegularExpression ? token : Pattern.quote(token);
      final Term term=new Term(FIELD_NAME,text);
      q=new POSAwaredSpanRegexQuery(term,false);
      if (!caseSensitive) {
        ((POSAwaredSpanRegexQuery)q).setRegexImplementation(new JavaUtilRegexCapabilities(JavaUtilRegexCapabilities.FLAG_CASE_INSENSITIVE));
      }
    }
 else {
      final String text=isRegularExpression ? token : Pattern.quote(token);
      final Term term=new Term(FIELD_NAME,text);
      q=new POSAwaredSpanRegexNotQuery(term,false);
      if (!caseSensitive) {
        ((POSAwaredSpanRegexNotQuery)q).setRegexImplementation(new JavaUtilRegexCapabilities(JavaUtilRegexCapabilities.FLAG_CASE_INSENSITIVE));
      }
    }
  }
  return q;
}
