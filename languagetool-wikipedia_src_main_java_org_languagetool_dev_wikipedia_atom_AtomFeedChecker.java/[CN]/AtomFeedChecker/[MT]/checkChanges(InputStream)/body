{
  List<ChangeAnalysis> result=new ArrayList<>();
  long latestDiffId=0;
  int skipCount=0;
  try {
    List<AtomFeedItem> items=new AtomFeedParser().getAtomFeedItems(xml);
    Collections.reverse(items);
    int i=0;
    for (    AtomFeedItem item : items) {
      if (i++ == 0) {
        System.out.println("First date in Atom Feed: " + item.getDate());
        System.out.println("Latest date in database: " + lastDateOfPreviousRun);
        item.getDate();
      }
      if (lastDateOfPreviousRun != null && (item.getDate().before(lastDateOfPreviousRun) || item.getDate().equals(lastDateOfPreviousRun))) {
        System.out.println("Skipping " + item.getTitle() + ", date "+ item.getDate()+ " <= "+ lastDateOfPreviousRun);
        skipCount++;
      }
 else {
        try {
          System.out.println("Checking " + item.getTitle() + ", diff id "+ item.getDiffId());
          List<WikipediaRuleMatch> oldMatches=getMatches(item,item.getOldContent());
          List<WikipediaRuleMatch> newMatches=getMatches(item,item.getNewContent());
          ChangeAnalysis changeAnalysis=new ChangeAnalysis(item.getTitle(),item.getDiffId(),oldMatches,newMatches);
          result.add(changeAnalysis);
          if (item.getDiffId() > latestDiffId) {
            latestDiffId=item.getDiffId();
          }
        }
 catch (        Exception e) {
          e.printStackTrace();
        }
      }
    }
  }
 catch (  XMLStreamException e) {
    throw new RuntimeException(e);
  }
  if (lastDateOfPreviousRun != null && skipCount == 0) {
    System.err.println("Warning: no items from the Atom feed were skipped - this means that changes might be missing");
  }
  return new CheckResult(result,latestDiffId);
}
