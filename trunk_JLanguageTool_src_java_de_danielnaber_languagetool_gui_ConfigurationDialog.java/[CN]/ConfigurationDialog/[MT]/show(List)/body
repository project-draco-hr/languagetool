{
  dialog=new JDialog();
  dialog.setTitle("LanguageTool Options");
  checkBoxes.clear();
  checkBoxesRuleIds.clear();
  KeyStroke stroke=KeyStroke.getKeyStroke(KeyEvent.VK_ESCAPE,0);
  ActionListener actionListener=new ActionListener(){
    public void actionPerformed(    ActionEvent actionEvent){
      if (actionEvent == null)       actionEvent=null;
      isClosed=true;
      dialog.hide();
    }
  }
;
  JRootPane rootPane=dialog.getRootPane();
  rootPane.registerKeyboardAction(actionListener,stroke,JComponent.WHEN_IN_FOCUSED_WINDOW);
  JPanel checkBoxPanel=new JPanel();
  checkBoxPanel.setLayout(new GridBagLayout());
  GridBagConstraints cons=new GridBagConstraints();
  cons.anchor=GridBagConstraints.NORTHWEST;
  cons.gridx=0;
  int row=0;
  for (Iterator iter=rules.iterator(); iter.hasNext(); ) {
    Rule rule=(Rule)iter.next();
    cons.gridy=row;
    JCheckBox checkBox=null;
    if (rule instanceof PatternRule) {
      PatternRule patternRule=(PatternRule)rule;
      checkBox=new JCheckBox(rule.getDescription() + " -- " + patternRule.getPattern());
    }
 else {
      checkBox=new JCheckBox(rule.getDescription());
    }
    if (inactiveRuleIds != null && inactiveRuleIds.contains(rule.getId()))     checkBox.setSelected(false);
 else     checkBox.setSelected(true);
    checkBoxes.add(checkBox);
    checkBoxesRuleIds.add(rule.getId());
    checkBoxPanel.add(checkBox,cons);
    row++;
  }
  JPanel buttonPanel=new JPanel();
  buttonPanel.setLayout(new GridBagLayout());
  JButton okButton=new JButton(OK_BUTTON);
  okButton.addActionListener(this);
  JButton cancelButton=new JButton(CANCEL_BUTTON);
  cancelButton.addActionListener(this);
  motherTongueBox=new JComboBox(getPossibleMotherTongues());
  if (motherTongue != null)   motherTongueBox.setSelectedItem(motherTongue);
  cons=new GridBagConstraints();
  cons.insets=new Insets(0,4,0,0);
  buttonPanel.add(new JLabel("Your mother tongue: "),cons);
  buttonPanel.add(motherTongueBox,cons);
  buttonPanel.add(okButton,cons);
  buttonPanel.add(cancelButton,cons);
  Container contentPane=dialog.getContentPane();
  contentPane.setLayout(new GridBagLayout());
  cons=new GridBagConstraints();
  cons.insets=new Insets(4,4,4,4);
  cons.gridx=0;
  cons.gridy=0;
  cons.weightx=10.0f;
  cons.weighty=10.0f;
  cons.fill=GridBagConstraints.BOTH;
  contentPane.add(new JScrollPane(checkBoxPanel),cons);
  cons.gridx=0;
  cons.gridy=1;
  cons.weightx=0.0f;
  cons.weighty=0.0f;
  cons.fill=GridBagConstraints.NONE;
  cons.anchor=GridBagConstraints.EAST;
  contentPane.add(buttonPanel,cons);
  dialog.pack();
  dialog.setModal(modal);
  dialog.setSize(500,500);
  isClosed=false;
  Dimension screenSize=Toolkit.getDefaultToolkit().getScreenSize();
  Dimension frameSize=dialog.getSize();
  dialog.setLocation(screenSize.width / 2 - (frameSize.width / 2),screenSize.height / 2 - (frameSize.height / 2));
  dialog.setVisible(true);
}
