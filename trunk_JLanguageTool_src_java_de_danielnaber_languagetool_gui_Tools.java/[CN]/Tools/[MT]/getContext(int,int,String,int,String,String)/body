{
  fileContents=fileContents.replaceAll("\n"," ");
  int startContent=fromPos - contextSize;
  String prefix="...";
  String postfix="...";
  String markerPrefix="   ";
  if (startContent < 0) {
    prefix="";
    markerPrefix="";
    startContent=0;
  }
  int endContent=toPos + contextSize;
  int fileLen=fileContents.length();
  if (endContent > fileLen) {
    postfix="";
    endContent=fileLen;
  }
  StringBuilder marker=new StringBuilder();
  int totalLen=fileLen + prefix.length();
  for (int i=0; i < totalLen; i++) {
    if (i >= fromPos && i < toPos)     marker.append("^");
 else     marker.append(" ");
  }
  StringBuilder sb=new StringBuilder();
  sb.append(prefix);
  sb.append(fileContents.substring(startContent,endContent));
  String markerStr=markerPrefix + marker.substring(startContent,endContent);
  sb.append(postfix);
  int startMark=markerStr.indexOf("^");
  int endMark=markerStr.lastIndexOf("^");
  String result=sb.toString();
  result=result.substring(0,startMark) + markerStart + result.substring(startMark,endMark + 1)+ markerEnd+ result.substring(endMark + 1);
  return result;
}
