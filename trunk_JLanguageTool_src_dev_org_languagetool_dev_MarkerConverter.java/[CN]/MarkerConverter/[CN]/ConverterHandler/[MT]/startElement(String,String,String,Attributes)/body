{
  if (qName.equals("token") && inCategory) {
    currentTokenPos++;
    final String key=currentId + " " + currentSubId;
    if (needsMarker && startPos.get(key) == currentTokenPos - 1) {
      System.out.print("<marker>\n");
    }
  }
  if (attrs.getLength() > 0) {
    System.out.print("<" + qName);
    for (int i=0; i < attrs.getLength(); i++) {
      final String qName1=attrs.getQName(i);
      if (qName1.equals("mark_from") || qName1.equals("mark_to")) {
        continue;
      }
      System.out.print(" " + qName1 + "=\""+ StringTools.escapeXML(attrs.getValue(qName1))+ "\"");
    }
    System.out.print(">");
  }
 else {
    System.out.print("<" + qName + ">");
  }
  if (qName.equals("category")) {
    inCategory=true;
  }
 else   if (qName.equals("pattern")) {
    final boolean defaultStart=attrs.getValue("mark_from") == null || attrs.getValue("mark_from").equals("0");
    final boolean defaultEnd=attrs.getValue("mark_to") == null || attrs.getValue("mark_to").equals("0");
    needsMarker=!defaultStart || !defaultEnd;
  }
 else   if (qName.equals("rulegroup")) {
    currentTokenPos=0;
    currentId=attrs.getValue("id");
    currentSubId=0;
    inRuleGroup=true;
  }
 else   if (qName.equals("rule")) {
    currentTokenPos=0;
    if (attrs.getValue("id") != null) {
      currentId=attrs.getValue("id");
    }
    if (inRuleGroup) {
      currentSubId++;
    }
 else {
      currentSubId=1;
    }
  }
}
