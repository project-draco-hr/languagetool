{
  XModel xModel=(XModel)UnoRuntime.queryInterface(XModel.class,xTextDoc);
  if (xModel == null) {
    DialogThread dt=new DialogThread("Sorry, only text documents are supported");
    dt.start();
    return null;
  }
  XController xController=xModel.getCurrentController();
  XTextViewCursorSupplier xViewCursorSupplier=(XTextViewCursorSupplier)UnoRuntime.queryInterface(XTextViewCursorSupplier.class,xController);
  xViewCursor=xViewCursorSupplier.getViewCursor();
  String textToCheck=xViewCursor.getString();
  boolean selection=true;
  if (textToCheck.equals("")) {
    selection=false;
    XText text=xTextDoc.getText();
    textToCheck=text.getString();
    if (textToCheck.equals("")) {
      JOptionPane.showMessageDialog(null,"No text to check. Please note that documents > 64 KB are not yet supported","Error",JOptionPane.ERROR_MESSAGE);
    }
    xViewCursor=null;
  }
  textToCheck=textToCheck.replaceAll("\r\n","\n");
  return new TextToCheck(textToCheck,selection);
}
