{
  final SwebleWikipediaTextFilter filter=new SwebleWikipediaTextFilter();
  final PlainTextMapping mapping=filter.filter(wikiContent.getContent());
  final MultiThreadedJLanguageTool langTool=getLanguageTool(language);
  final List<AppliedRuleMatch> appliedMatches=new ArrayList<>();
  final List<RuleMatch> matches;
  try {
    matches=langTool.check(mapping.getPlainText());
  }
  finally {
    langTool.shutdown();
  }
  int internalErrors=0;
  for (  RuleMatch match : matches) {
    final SuggestionReplacer replacer=errorMarker != null ? new SuggestionReplacer(mapping,wikiContent.getContent(),errorMarker) : new SuggestionReplacer(mapping,wikiContent.getContent());
    try {
      final List<RuleMatchApplication> ruleMatchApplications=replacer.applySuggestionsToOriginalText(match);
      appliedMatches.add(new AppliedRuleMatch(match,ruleMatchApplications));
    }
 catch (    Exception e) {
      System.err.println("Failed to apply suggestion for rule match '" + match + "' for URL "+ url+ ": "+ e);
      internalErrors++;
    }
  }
  return new MarkupAwareWikipediaResult(wikiContent,appliedMatches,internalErrors);
}
