{
  CgSet newSet=new CgSet();
  newSet.line=set.line;
  newSet.type=set.type;
  newSet.name=set.name;
  if (set.sets.isEmpty()) {
    return set;
  }
 else   if (set.sets.size() > 1 && set.set_ops.isEmpty()) {
    System.err.println("Error: something wonky with the set on line " + set.line);
    System.exit(1);
  }
 else   if (set.set_ops.isEmpty()) {
    CgSet expandedSet=expandSetSets(grammar.getSet(set.sets.get(0)));
    for (    CgCompositeTag ctag : expandedSet.tags) {
      newSet.tags.add(ctag);
    }
    for (    CgTag tag : expandedSet.single_tags) {
      newSet.single_tags.add(tag);
    }
  }
 else {
    for (int op=0; op < set.set_ops.size(); op++) {
      CgSet expandedSet1=expandSetSets(grammar.getSet(set.sets.get(op)));
      CgSet expandedSet2=expandSetSets(grammar.getSet(set.sets.get(op + 1)));
      if (set.set_ops.get(op) == 4) {
        for (        CgTag tag : expandedSet1.single_tags) {
          for (          CgTag tag2 : expandedSet2.single_tags) {
            if (tag.tag.equals(tag2.tag)) {
              newSet.addTag(tag);
            }
 else {
              CgCompositeTag ctag=new CgCompositeTag();
              ctag.addTag(tag);
              ctag.addTag(tag2);
              newSet.addCompositeTag(ctag);
            }
          }
        }
        for (        CgCompositeTag ctag : expandedSet1.tags) {
          for (          CgTag tag : expandedSet2.single_tags) {
            if (ctag.tags.contains(tag)) {
              newSet.addCompositeTag(ctag);
            }
 else {
              CgCompositeTag ctagnew=new CgCompositeTag();
              for (              CgTag tag2 : ctag.tags) {
                ctagnew.addTag(tag2);
              }
              ctagnew.addTag(tag);
              newSet.addCompositeTag(ctagnew);
            }
          }
        }
        for (        CgCompositeTag ctag : expandedSet2.tags) {
          for (          CgTag tag : expandedSet1.single_tags) {
            if (ctag.tags.contains(tag)) {
              newSet.addCompositeTag(ctag);
            }
 else {
              CgCompositeTag ctagnew=new CgCompositeTag();
              for (              CgTag tag2 : ctag.tags) {
                ctagnew.addTag(tag2);
              }
              ctagnew.addTag(tag);
              newSet.addCompositeTag(ctagnew);
            }
          }
        }
        for (        CgCompositeTag ctag : expandedSet1.tags) {
          for (          CgCompositeTag ctag2 : expandedSet2.tags) {
            CgCompositeTag ctagnew=new CgCompositeTag();
            for (            CgTag tag : ctag.tags) {
              if (!ctagnew.tags.contains(tag)) {
                ctagnew.addTag(tag);
              }
            }
            for (            CgTag tag : ctag2.tags) {
              if (!ctagnew.tags.contains(tag)) {
                ctagnew.addTag(tag);
              }
            }
            newSet.addCompositeTag(ctagnew);
          }
        }
      }
 else       if (set.set_ops.get(op) == 3) {
        for (        CgCompositeTag ctag : expandedSet1.tags) {
          newSet.addCompositeTag(ctag);
        }
        for (        CgCompositeTag ctag : expandedSet2.tags) {
          newSet.addCompositeTag(ctag);
        }
        for (        CgTag tag : expandedSet1.single_tags) {
          newSet.addTag(tag);
        }
        for (        CgTag tag : expandedSet2.single_tags) {
          newSet.addTag(tag);
        }
      }
    }
  }
  return newSet;
}
