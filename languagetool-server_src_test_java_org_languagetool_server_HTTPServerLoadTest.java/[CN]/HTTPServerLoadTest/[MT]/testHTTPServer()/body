{
  final long startTime=System.currentTimeMillis();
  HTTPServerConfig config=new HTTPServerConfig(HTTPTools.getDefaultPort(),true);
  final HTTPServer server=new HTTPServer(config);
  assertFalse(server.isRunning());
  try {
    server.run();
    assertTrue(server.isRunning());
    final ExecutorService executorService=Executors.newFixedThreadPool(getThreadCount());
    final List<Future> futures=new ArrayList<>();
    for (int i=0; i < getThreadCount(); i++) {
      final Future<?> future=executorService.submit(new TestRunnable());
      futures.add(future);
    }
    for (    Future future : futures) {
      future.get();
    }
  }
  finally {
    server.stop();
    assertFalse(server.isRunning());
    final long runtime=System.currentTimeMillis() - startTime;
    System.out.println("Running with " + getThreadCount() + " threads in "+ runtime+ "ms");
  }
}
