{
  final long startTime=System.currentTimeMillis();
  final HTTPServer server=new HTTPServer();
  assertFalse(server.isRunning());
  try {
    server.run();
    assertTrue(server.isRunning());
    final ExecutorService executorService=Executors.newFixedThreadPool(THREAD_COUNT);
    final List<Future> futures=new ArrayList<>();
    for (int i=0; i < THREAD_COUNT; i++) {
      final Future<?> future=executorService.submit(new TestRunnable());
      futures.add(future);
    }
    for (    Future future : futures) {
      future.get();
    }
  }
  finally {
    server.stop();
    assertFalse(server.isRunning());
    final long runtime=System.currentTimeMillis() - startTime;
    System.out.println("Running with " + THREAD_COUNT + " threads in "+ runtime+ "ms");
  }
}
