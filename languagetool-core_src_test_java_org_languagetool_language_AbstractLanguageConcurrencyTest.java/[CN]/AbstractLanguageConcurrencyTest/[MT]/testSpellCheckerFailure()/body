{
  final String sampleText=createSampleText();
  final Language language=createLanguage();
  final int threadCount=Runtime.getRuntime().availableProcessors() * 10;
  final int testRuns=100;
  final ReadWriteLock testWaitLock=new ReentrantReadWriteLock();
  final Lock testWriteLock=testWaitLock.writeLock();
  testWriteLock.lock();
  failedTests=0;
  List<Thread> threads=new ArrayList<>();
  for (int i=0; i < threadCount; i++) {
    Thread t=new Thread(new TestRunner(testWaitLock,language,testRuns,sampleText));
    t.start();
    threads.add(t);
  }
  testWriteLock.unlock();
  for (  Thread t : threads) {
    t.join();
  }
  Assert.assertEquals(0,failedTests);
}
