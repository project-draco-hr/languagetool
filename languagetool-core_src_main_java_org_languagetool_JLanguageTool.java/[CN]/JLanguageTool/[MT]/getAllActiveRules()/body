{
  final List<Rule> rules=new ArrayList<>();
  final List<Rule> rulesActive=new ArrayList<>();
  rules.addAll(builtinRules);
  rules.addAll(userRules);
  for (  Rule rule : rules) {
    Category ruleCategory=rule.getCategory();
    boolean isCategoryDisabled=(disabledRuleCategories.contains(ruleCategory.getId()) || rule.getCategory().isDefaultOff()) && !enabledRuleCategories.contains(ruleCategory.getId());
    boolean isRuleDisabled=disabledRules.contains(rule.getId()) || (rule.isDefaultOff() && !enabledRules.contains(rule.getId()));
    boolean isEnabled=true;
    if (isCategoryDisabled && enabledRules.contains(rule.getId())) {
      isEnabled=true;
    }
 else     if (isCategoryDisabled) {
      isEnabled=false;
    }
 else     if (isRuleDisabled) {
      isEnabled=false;
    }
    if (isEnabled) {
      rulesActive.add(rule);
    }
  }
  return rulesActive;
}
