{
  String[] formattedString=new String[1];
  if (formattedToken != null) {
    formattedString[0]=formattedToken.getToken();
    if (pRegexMatch != null) {
      formattedString[0]=pRegexMatch.matcher(formattedString[0]).replaceAll(regexReplace);
    }
switch (caseConversionType) {
case NONE:
      formattedString[0]=formattedString[0];
    break;
case STARTLOWER:
  formattedString[0]=formattedString[0].substring(0,1).toLowerCase() + formattedToken.getToken().substring(1);
break;
case STARTUPPER:
formattedString[0]=formattedString[0].substring(0,1).toUpperCase() + formattedToken.getToken().substring(1);
break;
case ALLUPPER:
formattedString[0]=formattedString[0].toUpperCase();
break;
case ALLLOWER:
formattedString[0]=formattedString[0].toLowerCase();
break;
default :
formattedString[0]=formattedString[0];
break;
}
if (posTag != null) {
if (synthesizer == null) {
formattedString[0]=formattedToken.getToken();
}
 else if (postagRegexp) {
final int readingCount=formattedToken.getReadingsLength();
final String targetPosTag=getTargetPosTag();
final TreeSet<String> wordForms=new TreeSet<String>();
for (int i=0; i < readingCount; i++) {
final String[] possibleWordForms=synthesizer.synthesize(formattedToken.getAnalyzedToken(i),targetPosTag,true);
if (possibleWordForms != null) {
for (final String form : possibleWordForms) {
wordForms.add(form);
}
}
}
if (wordForms != null) {
if (wordForms.isEmpty()) {
formattedString[0]="(" + formattedToken.getToken() + ")";
}
 else {
formattedString=wordForms.toArray(new String[wordForms.size()]);
}
}
 else {
formattedString[0]=formattedToken.getToken();
}
}
 else {
final int readingCount=formattedToken.getReadingsLength();
final TreeSet<String> wordForms=new TreeSet<String>();
for (int i=0; i < readingCount; i++) {
final String[] possibleWordForms=synthesizer.synthesize(formattedToken.getAnalyzedToken(i),posTag);
if (possibleWordForms != null) {
for (final String form : possibleWordForms) {
wordForms.add(form);
}
}
}
if (wordForms == null) {
formattedString[0]=formattedToken.getToken();
}
 else {
formattedString=wordForms.toArray(new String[wordForms.size()]);
}
}
}
}
return formattedString;
}
