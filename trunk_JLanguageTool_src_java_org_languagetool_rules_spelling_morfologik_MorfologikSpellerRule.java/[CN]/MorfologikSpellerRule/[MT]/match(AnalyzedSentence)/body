{
  final List<RuleMatch> ruleMatches=new ArrayList<RuleMatch>();
  final AnalyzedTokenReadings[] tokens=text.getTokensWithoutWhitespace();
  if (speller == null) {
    if (JLanguageTool.getDataBroker().resourceExists(getFileName())) {
      final URL url=JLanguageTool.getDataBroker().getFromResourceDirAsUrl(getFileName());
      speller=new Speller(Dictionary.read(url));
    }
 else {
      return toRuleMatchArray(ruleMatches);
    }
  }
  for (  AnalyzedTokenReadings token : tokens) {
    final String word=token.getToken();
    if (!token.isImmunized()) {
      if (tokenizingPattern() == null) {
        ruleMatches.addAll(getRuleMatch(word,token.getStartPos()));
      }
 else {
        int i=0;
        for (        final String internalSplit : tokenizingPattern().split(word)) {
          ruleMatches.addAll(getRuleMatch(internalSplit,token.getStartPos() + i));
          i+=internalSplit.length() + separatorLength();
        }
      }
    }
  }
  return toRuleMatchArray(ruleMatches);
}
