{
  bytes.clear();
  charBuffer.clear();
  charBuffer=ensureCapacity(charBuffer,str.length() + 1);
  for (int i=0; i < str.length(); i++) {
    char chr=str.charAt(i);
    charBuffer.put(chr);
  }
  charBuffer.put('\u0000');
  charBuffer.flip();
  final int maxCapacity=(int)(charBuffer.remaining() * encoder.maxBytesPerChar());
  if (bytes.capacity() <= maxCapacity) {
    bytes=ByteBuffer.allocate(maxCapacity);
  }
  charBuffer.mark();
  encoder.reset();
  encoder.encode(charBuffer,bytes,true);
  bytes.flip();
  charBuffer.reset();
  return bytes.array();
}
