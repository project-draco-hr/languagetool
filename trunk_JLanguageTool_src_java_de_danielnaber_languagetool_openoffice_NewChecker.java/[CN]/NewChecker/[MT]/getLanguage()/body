{
  if (xTextDoc == null)   return Language.ENGLISH;
  Locale charLocale;
  try {
    XTextCursor textCursor=xTextDoc.getText().createTextCursor();
    textCursor.gotoStart(false);
    XPropertySet xCursorProps=(XPropertySet)UnoRuntime.queryInterface(XPropertySet.class,textCursor);
    charLocale=(Locale)xCursorProps.getPropertyValue("CharLocale");
    if (!hasLocale(charLocale)) {
      DialogThread dt=new DialogThread("Error: Sorry, the document language '" + charLocale.Language + "' is not supported by LanguageTool.");
      dt.start();
      return null;
    }
  }
 catch (  UnknownPropertyException e) {
    throw new RuntimeException(e);
  }
catch (  WrappedTargetException e) {
    throw new RuntimeException(e);
  }
  return Language.getLanguageForShortName(charLocale.Language);
}
