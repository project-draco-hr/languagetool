{
  if (allFeatsIn && equivalencesMatched.isEmpty()) {
    return false;
  }
  if ("".equals(feature)) {
    return false;
  }
  boolean unified=true;
  final String features[]=feature.split(",");
  String types[];
  if (!allFeatsIn) {
    tokCnt++;
    if (equivalencesMatched.size() <= tokCnt) {
      Map<String,Set<String>> mapTemp=new HashMap<String,Set<String>>();
      equivalencesMatched.add(mapTemp);
    }
    for (    String feat : features) {
      if ("".equals(type)) {
        types=equivalenceFeatures.get(feat).toArray(new String[equivalenceFeatures.get(feat).size()]);
      }
 else {
        types=type.split(",");
      }
      for (      String typename : types) {
        Element testElem=equivalenceTypes.get(feat + ":" + typename);
        if (testElem == null) {
          return false;
        }
        if (testElem.isMatched(AT)) {
          if (!equivalencesMatched.get(tokCnt).containsKey(feat)) {
            Set<String> typeSet=new HashSet<String>();
            typeSet.add(typename);
            equivalencesMatched.get(tokCnt).put(feat,typeSet);
          }
 else {
            equivalencesMatched.get(tokCnt).get(feat).add(typename);
          }
        }
      }
      unified&=equivalencesMatched.get(tokCnt).containsKey(feat);
      if (!unified) {
        break;
      }
    }
  }
 else {
    unified&=checkNext(AT,features,type);
  }
  return (unified) ^ negation;
}
