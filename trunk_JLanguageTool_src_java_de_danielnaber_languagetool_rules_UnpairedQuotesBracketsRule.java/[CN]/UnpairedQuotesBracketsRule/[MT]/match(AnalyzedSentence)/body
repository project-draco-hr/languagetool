{
  ruleMatches=new ArrayList<RuleMatch>();
  final AnalyzedTokenReadings[] tokens=text.getTokensWithoutWhitespace();
  if (endOfParagraph) {
    reset();
  }
  ruleMatchIndex=getMatchesIndex();
  for (int i=1; i < tokens.length; i++) {
    for (int j=0; j < startSymbols.length; j++) {
      final String token=tokens[i].getToken();
      if (token.equals(startSymbols[j]) || token.equals(endSymbols[j])) {
        boolean precededByWhitespace=true;
        if (startSymbols[j].equals(endSymbols[j])) {
          precededByWhitespace=tokens[i - 1].isSentStart() || tokens[i].isWhitespaceBefore() || PUNCTUATION_NO_DOT.matcher(tokens[i - 1].getToken()).matches();
        }
        boolean followedByWhitespace=true;
        if (i < tokens.length - 1 && startSymbols[j].equals(endSymbols[j])) {
          followedByWhitespace=tokens[i + 1].isWhitespaceBefore() || PUNCTUATION.matcher(tokens[i + 1].getToken()).matches();
        }
        if (followedByWhitespace && precededByWhitespace) {
          if (i == tokens.length) {
            precededByWhitespace=false;
          }
 else           if (startSymbols[j].equals(endSymbols[j])) {
            if (symbolStack.empty()) {
              followedByWhitespace=false;
            }
 else {
              precededByWhitespace=false;
            }
          }
        }
        boolean noException=true;
        if (ruleLang.equals(Language.ENGLISH) && i > 1) {
          noException=isEnglishException(token,tokens,i,precededByWhitespace,followedByWhitespace);
        }
        if (noException && precededByWhitespace && token.equals(startSymbols[j])) {
          symbolStack.push(new SymbolLocator(startSymbols[j],i));
        }
 else         if (noException && followedByWhitespace && token.equals(endSymbols[j])) {
          if (i > 1 && endSymbols[j].equals(")")) {
            if ((NUMERALS.matcher(tokens[i - 1].getToken()).matches() && !(!symbolStack.empty() && "(".equals(symbolStack.peek().symbol)))) {
              noException=false;
            }
          }
          if (noException)           if (symbolStack.isEmpty()) {
            symbolStack.push(new SymbolLocator(endSymbols[j],i));
          }
 else {
            if (symbolStack.peek().symbol.equals(startSymbols[j])) {
              symbolStack.pop();
            }
 else {
              symbolStack.push(new SymbolLocator(endSymbols[j],i));
            }
          }
        }
      }
    }
  }
  for (  final SymbolLocator sLoc : symbolStack) {
    final RuleMatch rMatch=createMatch(tokens[sLoc.index].getStartPos(),sLoc.symbol);
    if (rMatch != null) {
      ruleMatches.add(rMatch);
    }
  }
  symbolStack.clear();
  if (tokens[tokens.length - 1].isParaEnd()) {
    endOfParagraph=true;
  }
  return toRuleMatchArray(ruleMatches);
}
