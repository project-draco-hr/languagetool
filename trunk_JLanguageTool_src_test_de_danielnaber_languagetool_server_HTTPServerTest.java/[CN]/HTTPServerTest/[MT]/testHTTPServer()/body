{
  HTTPServer server=new HTTPServer();
  try {
    server.run();
    String enc="UTF-8";
    assertEquals("<?xml version=\"1.0\" encoding=\"" + enc + "\"?>\n<matches>\n</matches>\n",check(Language.GERMAN,""));
    assertEquals("<?xml version=\"1.0\" encoding=\"" + enc + "\"?>\n<matches>\n</matches>\n",check(Language.GERMAN,"Ein kleiner test"));
    assertTrue(check(Language.GERMAN,"ein kleiner test").indexOf("UPPERCASE_SENTENCE_START") != -1);
    String result=check(Language.GERMAN,"ein kleiner test. Und wieder Erwarten noch was: \u00f6\u00e4\u00fc\u00df.");
    assertTrue(result.indexOf("UPPERCASE_SENTENCE_START") != -1);
    assertTrue(result.indexOf("WIEDER_WILLEN") != -1);
    assertTrue("Expected special chars, got: '" + result + "'",result.indexOf("\u00f6\u00e4\u00fc\u00df") != -1);
    XMLValidator validator=new XMLValidator();
    validator.validateXMLString(result,"/resource/api-output.dtd","matches");
    validator.checkSimpleXMLString(result);
    assertTrue(check(Language.GERMAN,"bla <script>").indexOf("<script>") == -1);
    String germanSpecialChars=check(Language.GERMAN,"ein kleiner test. Und wieder Erwarten noch was: ???????? ????????.");
    assertTrue("Expected special chars, got: '" + germanSpecialChars + "'",germanSpecialChars.contains("????????"));
    String romanianSpecialChars=check(Language.ROMANIAN,"bla bla ?????????? ?????????? ??i c??teva caractere speciale");
    assertTrue("Expected special chars, got: '" + romanianSpecialChars + "'",romanianSpecialChars.contains("??????????"));
    String polishSpecialChars=check(Language.POLISH,"M??wi??a d??ugo, ??eby tylko m??wi?? m??wi?? d??ugo.");
    assertTrue("Expected special chars, got: '" + polishSpecialChars + "'",polishSpecialChars.contains("m??wi??"));
    assertTrue(checkByPOST(Language.ROMANIAN,"gre??it gre??it").indexOf("gre??it") != -1);
    URL url=new URL("http://localhost:" + HTTPServer.DEFAULT_PORT + "/Languages");
    String languagesXML=StringTools.streamToString((InputStream)url.getContent());
    if (!languagesXML.contains("Romanian") || !languagesXML.contains("English"))     fail("Error getting supported languages: " + languagesXML);
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
 finally {
    server.stop();
  }
}
