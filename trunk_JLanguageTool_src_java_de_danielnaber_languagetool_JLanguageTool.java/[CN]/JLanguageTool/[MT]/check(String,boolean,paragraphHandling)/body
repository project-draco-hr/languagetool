{
  sentenceCount=0;
  final List<String> sentences;
  if (tokenizeText) {
    sentences=sentenceTokenize(text);
  }
 else {
    sentences=new ArrayList<String>();
    sentences.add(text);
  }
  final List<RuleMatch> ruleMatches=new ArrayList<RuleMatch>();
  final List<Rule> allRules=getAllRules();
  printIfVerbose(allRules.size() + " rules activated for language " + language);
  int tokenCount=0;
  int lineCount=0;
  int columnCount=1;
  unknownWords=new HashSet<String>();
  for (  final String sentence : sentences) {
    sentenceCount++;
    AnalyzedSentence analyzedText=getAnalyzedSentence(sentence);
    rememberUnknownWords(analyzedText);
    if (sentenceCount == sentences.size()) {
      final AnalyzedTokenReadings[] anTokens=analyzedText.getTokens();
      anTokens[anTokens.length - 1].setParaEnd();
      analyzedText=new AnalyzedSentence(anTokens);
    }
    final List<RuleMatch> sentenceMatches=new ArrayList<RuleMatch>();
    printIfVerbose(analyzedText.toString());
    for (    final Rule rule : allRules) {
      if (disabledRules.contains(rule.getId()) || (rule.isDefaultOff() && !enabledRules.contains(rule.getId()))) {
        continue;
      }
      if (disabledCategories.contains(rule.getCategory().getName())) {
        continue;
      }
switch (paraMode) {
case ONLYNONPARA:
{
          if (rule.isParagraphBackTrack()) {
            continue;
          }
          break;
        }
case ONLYPARA:
{
        if (!rule.isParagraphBackTrack()) {
          continue;
        }
        break;
      }
case NORMAL:
default :
  }
  final RuleMatch[] thisMatches=rule.match(analyzedText);
  for (  final RuleMatch element1 : thisMatches) {
    RuleMatch thisMatch=adjustRuleMatchPos(element1,tokenCount,columnCount,lineCount,sentence);
    sentenceMatches.add(thisMatch);
    if (rule.isParagraphBackTrack()) {
      rule.addRuleMatch(thisMatch);
    }
  }
}
Collections.sort(sentenceMatches);
ruleMatches.addAll(sentenceMatches);
tokenCount+=sentence.length();
lineCount+=countLineBreaks(sentence);
final int lineBreakPos=sentence.indexOf('\n');
if (lineBreakPos == -1) {
  columnCount+=sentence.length() - 1;
}
 else {
  if (lineBreakPos == 0) {
    columnCount=sentence.length();
    if (!language.getSentenceTokenizer().singleLineBreaksMarksPara()) {
      columnCount--;
    }
  }
 else {
    columnCount=1;
  }
}
}
if (!paraMode.equals(paragraphHandling.ONLYNONPARA)) {
for (final Rule rule : allRules) {
  if (rule.isParagraphBackTrack() && (rule.getMatches() != null)) {
    final List<RuleMatch> rm=rule.getMatches();
    for (    final RuleMatch r : rm) {
      if (rule.isInRemoved(r)) {
        ruleMatches.remove(r);
      }
    }
  }
}
}
return ruleMatches;
}
