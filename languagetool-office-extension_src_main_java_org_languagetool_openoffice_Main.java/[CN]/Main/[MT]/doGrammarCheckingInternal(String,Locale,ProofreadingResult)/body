{
  if (!StringTools.isEmpty(paraText) && hasLocale(locale)) {
    Language langForShortName;
    try {
      if (locale.Language.equalsIgnoreCase(LIBREOFFICE_SPECIAL_LANGUAGE_TAG)) {
        langForShortName=Language.getLanguageForShortName(locale.Variant);
      }
 else {
        langForShortName=Language.getLanguageForShortName(locale.Language + "-" + locale.Country);
      }
    }
 catch (    java.lang.IllegalArgumentException e) {
      langForShortName=Language.getLanguageForShortName(locale.Language);
    }
    if (!langForShortName.equals(docLanguage) || langTool == null || recheck) {
      docLanguage=langForShortName;
      if (docLanguage == null) {
        return paRes;
      }
      initLanguageTool();
    }
    final Set<String> disabledRuleIds=config.getDisabledRuleIds();
    if (disabledRuleIds != null) {
      final ArrayList<String> list=new ArrayList<>(disabledRuleIds);
      for (      final String id : list) {
        langTool.disableRule(id);
      }
    }
    final Set<String> disabledCategories=config.getDisabledCategoryNames();
    if (disabledCategories != null) {
      final ArrayList<String> list=new ArrayList<>(disabledCategories);
      for (      final String categoryName : list) {
        langTool.disableCategory(categoryName);
      }
    }
    final Set<String> enabledRuleIds=config.getEnabledRuleIds();
    if (enabledRuleIds != null) {
      final ArrayList<String> list=new ArrayList<>(enabledRuleIds);
      for (      String ruleName : list) {
        langTool.enableDefaultOffRule(ruleName);
        langTool.enableRule(ruleName);
      }
    }
    try {
      final String sentence=getSentence(paraText,paRes.nStartOfSentencePosition);
      paRes.nStartOfSentencePosition=position;
      paRes.nStartOfNextSentencePosition=position + sentence.length();
      paRes.nBehindEndOfSentencePosition=paRes.nStartOfNextSentencePosition;
      if (!StringTools.isEmpty(sentence)) {
        final List<RuleMatch> ruleMatches=langTool.check(sentence,false,JLanguageTool.ParagraphHandling.ONLYNONPARA);
        final SingleProofreadingError[] pErrors=checkParaRules(paraText,locale,paRes.nStartOfSentencePosition,paRes.nStartOfNextSentencePosition,paRes.aDocumentIdentifier);
        int pErrorCount=0;
        if (pErrors != null) {
          pErrorCount=pErrors.length;
        }
        if (!ruleMatches.isEmpty()) {
          final SingleProofreadingError[] errorArray=new SingleProofreadingError[ruleMatches.size() + pErrorCount];
          int i=0;
          for (          final RuleMatch myRuleMatch : ruleMatches) {
            errorArray[i]=createOOoError(myRuleMatch,paRes.nStartOfSentencePosition);
            i++;
          }
          if (pErrors != null) {
            for (            SingleProofreadingError paraError : pErrors) {
              if (paraError != null) {
                errorArray[i]=paraError;
                i++;
              }
            }
          }
          Arrays.sort(errorArray,new ErrorPositionComparator());
          paRes.aErrors=errorArray;
        }
 else {
          if (pErrors != null) {
            paRes.aErrors=pErrors;
          }
        }
      }
    }
 catch (    final Throwable t) {
      showError(t);
      paRes.nBehindEndOfSentencePosition=paraText.length();
    }
  }
  return paRes;
}
