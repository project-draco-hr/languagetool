{
  List<RuleMatch> ruleMatches=new ArrayList<RuleMatch>();
  AnalyzedTokenReadings[] tokens=text.getTokensWithoutWhitespace();
  RuleMatch prevRuleMatch=null;
  Queue<AnalyzedTokenReadings> prevTokens=new ArrayBlockingQueue<AnalyzedTokenReadings>(MAX_TERMS);
  for (int i=0; i < tokens.length + MAX_TERMS - 1; i++) {
    AnalyzedTokenReadings token=null;
    if (i >= tokens.length)     token=new AnalyzedTokenReadings(new AnalyzedToken("","",prevTokens.peek().getStartPos()));
 else     token=tokens[i];
    if (i == 0) {
      addToQueue(token,prevTokens);
      continue;
    }
    StringBuilder sb=new StringBuilder();
    int j=0;
    AnalyzedTokenReadings firstMatchToken=null;
    List<String> stringsToCheck=new ArrayList<String>();
    List<String> origStringsToCheck=new ArrayList<String>();
    Map<String,AnalyzedTokenReadings> stringToToken=new HashMap<String,AnalyzedTokenReadings>();
    for (Iterator iter=prevTokens.iterator(); iter.hasNext(); ) {
      AnalyzedTokenReadings atr=(AnalyzedTokenReadings)iter.next();
      if (j == 0)       firstMatchToken=atr;
      sb.append(" ");
      sb.append(atr.getToken());
      if (j >= 1) {
        String stringtoCheck=normalize(sb.toString());
        stringsToCheck.add(stringtoCheck);
        origStringsToCheck.add(sb.toString().trim());
        if (!stringToToken.containsKey(stringtoCheck))         stringToToken.put(stringtoCheck,atr);
      }
      j++;
    }
    for (int k=stringsToCheck.size() - 1; k >= 0; k--) {
      String stringToCheck=stringsToCheck.get(k);
      String origStringToCheck=origStringsToCheck.get(k);
      if (incorrectCompounds.contains(stringToCheck)) {
        AnalyzedTokenReadings atr=stringToToken.get(stringToCheck);
        String msg=null;
        List<String> repl=new ArrayList<String>();
        if (!noDashSuggestion.contains(stringToCheck)) {
          repl.add(origStringToCheck.replace(' ','-'));
          msg="Dieses Kompositum wird mit Bindestrich geschrieben.";
        }
        if (!hasAllUppercaseParts(origStringToCheck) && countParts(stringToCheck) <= 2 && !onlyDashSuggestion.contains(stringToCheck)) {
          repl.add(mergeCompound(origStringToCheck));
          msg="Dieses Kompositum wird zusammengeschrieben.";
        }
        String[] parts=stringToCheck.split(" ");
        if (parts.length > 0 && parts[0].length() == 1) {
          repl.clear();
          repl.add(origStringToCheck.replace(' ','-'));
          msg="Dieses Kompositum wird mit Bindestrich geschrieben.";
        }
 else         if (repl.size() == 0 || repl.size() == 2) {
          msg="Dieses Kompositum wird zusammen oder mit Bindestrich geschrieben.";
        }
        RuleMatch ruleMatch=new RuleMatch(this,firstMatchToken.getStartPos(),atr.getStartPos() + atr.getToken().length(),msg);
        if (prevRuleMatch != null && prevRuleMatch.getFromPos() == ruleMatch.getFromPos()) {
          prevRuleMatch=ruleMatch;
          break;
        }
        prevRuleMatch=ruleMatch;
        ruleMatch.setSuggestedReplacements(repl);
        ruleMatches.add(ruleMatch);
        break;
      }
    }
    addToQueue(token,prevTokens);
  }
  return toRuleMatchArray(ruleMatches);
}
