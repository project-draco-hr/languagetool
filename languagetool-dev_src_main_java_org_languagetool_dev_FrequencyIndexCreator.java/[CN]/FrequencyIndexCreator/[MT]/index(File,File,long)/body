{
  System.out.println(file);
  String name=file.getName();
  if (name.matches(".*_[A-Z]+_.*")) {
    System.out.println("Skipping POS tag file " + name);
    return;
  }
  File indexDir;
  boolean hiveMode;
  if (name.matches(NAME_REGEX1)) {
    indexDir=new File(indexBaseDir,name.replaceAll(NAME_REGEX1,"$1"));
    hiveMode=false;
    System.out.println("Running in corpus mode (i.e. aggregation of years)");
  }
 else   if (name.matches(NAME_REGEX2)) {
    indexDir=new File(indexBaseDir,name.replaceAll(NAME_REGEX2,"$1"));
    hiveMode=true;
    System.out.println("Running in Hive mode (i.e. no aggregation of years)");
  }
 else {
    System.out.println("Skipping " + name + " - doesn't match regex "+ NAME_REGEX1+ " or "+ NAME_REGEX2);
    return;
  }
  if (indexDir.exists() && indexDir.isDirectory()) {
    if (isIndexComplete(indexDir)) {
      System.out.println("Skipping " + name + " - index dir '"+ indexDir+ "' already exists and is complete");
      bytesProcessed.addAndGet(file.length());
      return;
    }
 else {
      System.out.println("Not skipping " + name + " - index dir '"+ indexDir+ "' already exists but is not complete");
    }
  }
  System.out.println("Index dir: " + indexDir);
  try {
    Directory directory=FSDirectory.open(indexDir);
    Analyzer analyzer=new StandardAnalyzer(Version.LUCENE_4_10_3);
    IndexWriterConfig config=new IndexWriterConfig(Version.LUCENE_4_10_3,analyzer);
    config.setUseCompoundFile(false);
    config.setOpenMode(IndexWriterConfig.OpenMode.CREATE);
    try (IndexWriter writer=new IndexWriter(directory,config)){
      indexLinesFromGoogleFile(writer,file,totalBytes,hiveMode);
    }
     markIndexAsComplete(indexDir);
  }
 catch (  Exception e) {
    throw new RuntimeException("Could not index " + file,e);
  }
  bytesProcessed.addAndGet(file.length());
}
