{
  if (posStack.size() > 0) {
    final String pop=posStack.pop();
    restoreState(current);
    termAtt.append(pop);
    posIncrAtt.setPositionIncrement(0);
    typeAtt.setType("pos");
    return true;
  }
  if (tokenIter == null || !tokenIter.hasNext()) {
    if (input.incrementToken()) {
      final AnalyzedSentence sentence=languageTool.getAnalyzedSentence(termAtt.toString());
      final List<AnalyzedTokenReadings> tokenBuffer=Arrays.asList(sentence.getTokens());
      tokenIter=tokenBuffer.iterator();
      if (!tokenIter.hasNext()) {
        return false;
      }
    }
 else {
      return false;
    }
  }
  clearAttributes();
  final AnalyzedTokenReadings tr=tokenIter.next();
  if (tr.isSentenceStart()) {
    typeAtt.setType("pos");
    if (toLowerCase) {
      termAtt.append(POS_PREFIX.toLowerCase() + tr.getAnalyzedToken(0).getPOSTag().toLowerCase());
    }
 else {
      termAtt.append(POS_PREFIX + tr.getAnalyzedToken(0).getPOSTag());
    }
    return true;
  }
  if (tr.isWhitespace()) {
    return this.incrementToken();
  }
  final AnalyzedToken at=tr.getAnalyzedToken(0);
  offsetAtt.setOffset(tr.getStartPos(),tr.getStartPos() + at.getToken().length());
  for (  AnalyzedToken token : tr) {
    if (token.getPOSTag() != null) {
      if (toLowerCase) {
        posStack.push(POS_PREFIX.toLowerCase() + token.getPOSTag().toLowerCase());
      }
 else {
        posStack.push(POS_PREFIX + token.getPOSTag());
      }
    }
  }
  current=captureState();
  if (toLowerCase) {
    termAtt.append(tr.getAnalyzedToken(0).getToken().toLowerCase());
  }
 else {
    termAtt.append(tr.getAnalyzedToken(0).getToken());
  }
  return true;
}
