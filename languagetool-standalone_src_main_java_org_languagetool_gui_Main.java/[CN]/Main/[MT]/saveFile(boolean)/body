{
  if (currentFile == null || newFile) {
    JFileChooser jfc=new JFileChooser();
    jfc.setFileFilter(new PlainTextFileFilter());
    jfc.showSaveDialog(frame);
    File file=jfc.getSelectedFile();
    if (file == null) {
      return;
    }
    currentFile=file;
    BOM=null;
    updateTitle();
  }
  try {
    if (BOM != null) {
      FileUtils.writeByteArrayToFile(currentFile,BOM.getBytes());
      FileUtils.write(currentFile,textArea.getText(),BOM.getCharsetName(),true);
    }
 else {
      FileUtils.write(currentFile,textArea.getText(),Charset.defaultCharset());
    }
  }
 catch (  IOException ex) {
    Tools.showError(ex);
  }
}
